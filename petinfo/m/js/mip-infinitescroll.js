(window.MIP=window.MIP||[]).push({name:"mip-infinitescroll",func:function(){var e=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://c.mipcdn.com/static/v2/",n(n.s=156)}([function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/helpers/esm/classCallCheck"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/helpers/esm/createClass"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_wks"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_an-object"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/helpers/esm/getPrototypeOf"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/helpers/esm/inherits"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/helpers/esm/possibleConstructorReturn"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_defined"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_descriptors"]},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_to-length"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_fails"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_object-dp"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_to-integer"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_export"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_redefine"]},function(e,t,n){var r=n(38),o=n(7);e.exports=function(e){return r(o(e))}},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_hide"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_has"]},,,function(e,t,n){"use strict";var r=n(3);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_global"]},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_shared-key"]},,,,function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/web.dom.iterable"]},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_to-object"]},,,function(e,t,n){var r=n(18),o=n(16),i=n(40)(!1),s=n(24)("IE_PROTO");e.exports=function(e,t){var n,a=o(e),l=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>l;)r(a,n=t[l++])&&(~i(c,n)||c.push(n));return c}},function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_property-desc"]},function(e,t,n){var r=n(13),o=n(7);e.exports=function(e){return function(t,n){var i,s,a=String(o(t)),l=r(n),c=a.length;return l<0||l>=c?e?"":void 0:(i=a.charCodeAt(l))<55296||i>56319||l+1===c||(s=a.charCodeAt(l+1))<56320||s>57343?e?a.charAt(l):i:e?a.slice(l,l+2):s-56320+(i-55296<<10)+65536}}},,,,function(e,t,n){var r=n(9);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(13),o=Math.max,i=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):i(e,t)}},function(e,t,n){var r=n(16),o=n(10),i=n(39);e.exports=function(e){return function(t,n,s){var a,l=r(t),c=o(l.length),p=i(s,c);if(e&&n!=n){for(;c>p;)if((a=l[p++])!=a)return!0}else for(;c>p;p++)if((e||p in l)&&l[p]===n)return e||p||0;return!e&&-1}}},function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/regenerator/index"]},,,function(e,t){e.exports={}},function(e,t,n){var r=n(3),o=n(52),i=n(23),s=n(24)("IE_PROTO"),a=function(){},l=function(){var e,t=n(50)("iframe"),r=i.length;for(t.style.display="none",n(51).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[i[r]];return l()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=l(),void 0===t?n:o(n,t)}},,function(e,t,n){var r=n(12).f,o=n(18),i=n(2)("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(32),o=n(23);e.exports=Object.keys||function(e){return r(e,o)}},,function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_dom-create"]},function(e,t,n){var r=n(22).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(12),o=n(3),i=n(48);e.exports=n(8)?Object.defineProperties:function(e,t){o(e);for(var n,s=i(t),a=s.length,l=0;a>l;)r.f(e,n=s[l++],t[n]);return e}},,,,function(e,t){e.exports=__mipComponentsWebpackHelpers__["core-js/modules/_library"]},,,,,,,function(e,t,n){"use strict";var r=n(56),o=n(14),i=n(15),s=n(17),a=n(44),l=n(71),c=n(47),p=n(70),u=n(2)("iterator"),h=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,m,d,g,_){l(n,t,m);var v,b,w,y=function(e){if(!h&&e in k)return k[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",H="values"==d,S=!1,k=e.prototype,P=k[u]||k["@@iterator"]||d&&k[d],C=P||y(d),j=d?H?y("entries"):C:void 0,L="Array"==t&&k.entries||P;if(L&&(w=p(L.call(new e)))!==Object.prototype&&w.next&&(c(w,x,!0),r||"function"==typeof w[u]||s(w,u,f)),H&&P&&"values"!==P.name&&(S=!0,C=function(){return P.call(this)}),r&&!_||!h&&!S&&k[u]||s(k,u,C),a[t]=C,a[x]=f,d)if(v={values:H?C:y("values"),keys:g?C:y("keys"),entries:j},_)for(b in v)b in k||i(k,b,v[b]);else o(o.P+o.F*(h||S),t,v);return v}},function(e,t){e.exports=__mipComponentsWebpackHelpers__["@babel/runtime/helpers/esm/asyncToGenerator"]},,,,,,function(e,t,n){var r=n(18),o=n(29),i=n(24)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,n){"use strict";var r=n(45),o=n(33),i=n(47),s={};n(17)(s,n(2)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(s,{next:o(1,n)}),i(e,t+" Iterator")}},,function(e,t,n){"use strict";n(76);var r=n(3),o=n(21),i=n(8),s=/./.toString,a=function(e){n(15)(RegExp.prototype,"toString",e,!0)};n(11)(function(){return"/a/b"!=s.call({source:"a",flags:"b"})})?a(function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!i&&e instanceof RegExp?o.call(e):void 0)}):"toString"!=s.name&&a(function(){return s.call(this)})},,,function(e,t,n){n(8)&&"g"!=/./g.flags&&n(12).f(RegExp.prototype,"flags",{configurable:!0,get:n(21)})},,,,,,,function(e,t){e.exports=__mipComponentsWebpackHelpers__["regenerator-runtime/runtime"]},function(e,t,n){"use strict";var r=n(34)(!0);n(63)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(41),o=n.n(r),i=(n(83),n(64)),s=n.n(i),a=(n(73),n(84),n(0)),l=n.n(a),c=n(1),p=n.n(c),u=n(6),h=n.n(u),f=n(4),m=n.n(f),d=n(5),g=n.n(d),_=(n(28),MIP),v=_.viewport,b=_.util,w=b.css,y=b.dom,x=function(){function e(t){var n=this;if(l()(this,e),this.refresh=function(){"pause"!==n.state&&(n.wrapperHeight=v.getHeight(),n.scrollerHeight=n._getScrollerHeight(),n.currentScrollTop=v.getScrollTop())},t.$result&&t.$loading&&t.pushResult){var r=document.body;this.options=Object.assign({$wrapper:window,$scroller:r,firstResult:[],scrollPageClass:"mip-infinitescroll-page",loadingHtml:"加载中...",loadFailHtml:"加载失败,点击重试",loadOverHtml:"加载完毕",bufferHeightPx:10,pageResultNum:10,limitShowPn:2,preLoadPn:1},t),this.version="0.1.0",this._init()}}return p()(e,[{key:"_init",value:function(){this.eventSpace="",this.state="start",this.scrollPageCache={topPosition:[],content:[]},this.dataStatus=1,this.currentLoadPage=this.options.firstResult.length?0:-1,this.currentShowPage=0,this._horizontalHack(),this.options.$loading.innerHTML=this.options.loadingHtml,this.options.firstResult.length&&(this.scrollPageCache.content=this.scrollPageCache.content.concat(this._separatePage(this.options.firstResult)),this.options.$result.innerHTML=this._wrapPageParentDom(this.scrollPageCache.content[0],0),this.scrollPageCache.topPosition.push(this.options.$result.offsetTop)),this.refresh();var e=this.eventSpace;window.addEventListener("resize"+e,this.refresh),this._bindScroll(),this.options.firstResult.length||this._scrollBottomFn()}},{key:"destroy",value:function(){var e=this.eventSpace;window.removeEventListener("resize"+e,this.refresh),v.off("scroll",this.scrollListener),this.loadingClickListener&&this.options.$loading.removeEventListener("click"+e,this.loadingClickListener),this.scrollPageCache=null}},{key:"pause",value:function(){"pause"!==this.state&&(this.pauseScrollTop=this.currentScrollTop,this.state="pause")}},{key:"start",value:function(){if("start"!==this.state){var e=this.pauseScrollTop;this.options.$wrapper.scrollTop(e),this.refresh(),this.state="start"}}},{key:"_horizontalHack",value:function(){var e;void 0!==window.orientation?0===window.orientation||180===window.orientation?e=Math.min(window.screen.width,window.innerWidth):90!==window.orientation&&-90!==window.orientation||(e=(e=Math.min(window.screen.width,window.screen.height))*window.innerWidth/Math.max(window.screen.width,window.screen.height)):e=Math.min(window.screen.width,window.screen.height),w(this.options.$result,"max-width",e+"px")}},{key:"_bindScroll",value:function(){var e=this;this.scrollListener=function(){if("pause"!==e.state){e.currentScrollTop=v.getScrollTop(),e.wrapperHeight=v.getHeight(),e.currentScrollTop<=0&&e.options.onScrollTop&&e.options.onScrollTop(),e.currentScrollTop>=e._getScrollerHeight()-e.wrapperHeight-e.options.bufferHeightPx&&(e._scrollBottomFn(),e.options.onScrollBottom&&e.options.onScrollBottom());var t=e.getShowPage();e.currentShowPage!==t&&(e.options.onChangeShowPN&&e.options.onChangeShowPN(t,e.currentShowPage),e.currentShowPage=t,e.options.limitShowPn&&e._cycleScrollElement(t))}},v.on("scroll",this.scrollListener),this.currentScrollTop>=this._getScrollerHeight()-this.wrapperHeight-this.options.bufferHeightPx&&v.trigger("scroll")}},{key:"_scrollBottomFn",value:function(){var e=this.currentLoadPage+1,t=this.scrollPageCache.content.length-1;if(e<=t&&(this._updateScrollElement(e),this.options.onLoadNewPage&&this.options.onLoadNewPage(e)),1===this.dataStatus&&e+this.options.preLoadPn>=t){var n=this.options.pushResult((t+1)*this.options.pageResultNum,t-e);this.dataStatus=2;var r=this;n.then(function(e){!1===e||"NULL"===e?(r.dataStatus=0,r.options.$loading.innerHTML=r.options.loadOverHtml):e.length&&(r.dataStatus=1,r.scrollPageCache.content=r.scrollPageCache.content.concat(r._separatePage(e)),v.trigger("scroll"))},function(){r.dataStatus=3,r.options.$loading.innerHTML=r.options.loadFailHtml,r.loadingClickListener=function(){r.loadingClickListener=null,r.dataStatus=1,r.options.$loading.innerHTML=r.options.loadingHtml,v.trigger("scroll")},r.once(r.options.$loading,"click"+r.eventSpace,r.loadingClickListener)})}}},{key:"_updateScrollElement",value:function(e){var t=this._wrapPageParentDom(this.scrollPageCache.content[e],e);t=y.create(t),this.options.$result.appendChild(t),b.customEmit(document,"dom-change",{add:t}),this.currentLoadPage=e,this.scrollerHeight=this._getScrollerHeight(),this.scrollPageCache.topPosition.push(t.offsetTop)}},{key:"_getScrollerHeight",value:function(){return v.getScrollHeight()}},{key:"_cycleScrollElement",value:function(e){var t=this,n=Math.max(e-Math.floor((this.options.limitShowPn-1)/2),0),r=this.options.$result.querySelector("."+this.options.scrollPageClass),o=r.slice(n,n+this.options.limitShowPn);if(r.length){o.forEach(function(e){e.classList.contains("infinite-recycle")&&(e.innerHTML=t.scrollPageCache.content[e.getAttribute("data-page")],e.classList.remove("infinite-recycle"))});var i=document.querySelectorAll(".infinite-recycle");r.filter(function(e){return-1===o.indexOf(e)&&-1===i.indexOf(e)}).forEach(function(e){e.innerHTML="",t.classList.add("infinite-recycle")}),this.scrollerHeight=this._getScrollerHeight()}}},{key:"_separatePage",value:function(e){if(e.length&&"NULL"!==e){for(var t=this.options.pageResultNum,n=Math.ceil(e.length/t),r=[],o=0;o<n;o++)r.push(e.slice(o*t,o*t+t).join(""));return r}}},{key:"_wrapPageParentDom",value:function(e,t){return'<ul class="'.concat(this.options.scrollPageClass,'" data-page="').concat(t,'">').concat(e,"</ul>")}},{key:"getShowPage",value:function(){for(var e=this.scrollPageCache.topPosition.concat(),t=e.length-1;t>=0;t--)if(this.currentScrollTop>=e[t])return t;return 0}},{key:"once",value:function(e,t,n){e.addEventListener(t,function r(){n(),e.removeEventListener(t,r)})}}]),e}();n.d(t,"default",function(){return C});var H=MIP,S=H.CustomElement,k=H.util,P=H.templates,C=function(e){function t(){var e,n;l()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=h()(this,(e=m()(t)).call.apply(e,[this].concat(o)))).infiniteScroll=null,n.src="",n.resultWrapper=n.element.querySelector(".mip-infinitescroll-results"),n.loadingWrapper=n.element.querySelector(".mip-infinitescroll-loading"),n.resultWrapper&&(n.resultInitChildNodes=Array.from(n.resultWrapper.childNodes)),n.loadingWrapper&&(n.loadingInitHTML=n.loadingWrapper.innerHTML),n}return g()(t,e),p()(t,[{key:"prerenderAllowed",value:function(){return!0}},{key:"attributeChangedCallback",value:function(){this.element.isBuilt()&&(this.resetDOM(),this.refresh())}},{key:"firstInviewCallback",value:function(){var e=this;this.refresh(),this.addEventAction("refresh",function(){e.resetDOM(),e.refresh()})}},{key:"refresh",value:function(){var e=this,t=this.element;if(this.src=t.getAttribute("data-src")||"",!this.src)return console.error("data-src 为空，不能获取数据"),void t.remove();this.params={rn:20,prn:6,pn:1,pnName:"pn",bufferHeightPx:10,loadingHtml:"加载中...",loadFailHtml:"加载失败",loadOverHtml:"加载完毕!",renderTplFailHtml:"渲染模板失败",timeout:5e3};try{var n=t.querySelector('script[type="application/json"]');n&&(this.params=k.fn.extend(this.params,JSON.parse(n.textContent.toString())),this.params.rn="Infinity"===this.params.rn?1/0:this.params.rn)}catch(e){return console.warn("json is illegal"),void console.warn(e)}this.pushResult=function(){var n=s()(o.a.mark(function n(r,i){var s,a,l;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r>e.params.rn)){n.next=2;break}return n.abrupt("return","NULL");case 2:return n.prev=2,n.next=5,window.fetchJsonp(e.url,{jsonpCallback:"callback",timeout:e.params.timeout});case 5:return a=n.sent,n.next=8,a.json();case 8:s=n.sent,n.next=14;break;case 11:throw n.prev=11,n.t0=n.catch(2),new Error(e.params.loadFailHtml);case 14:if(!s||0!==parseInt(s.status,10)||!s.data){n.next=29;break}if(!(r>e.params.rn)&&s.data.items&&s.data.items.length){n.next=17;break}return n.abrupt("return","NULL");case 17:return n.prev=17,n.next=20,P.render(t,s.data.items);case 20:l=n.sent,n.next=26;break;case 23:throw n.prev=23,n.t1=n.catch(17),new Error(e.params.renderTplFailHtml);case 26:return e.params.pn++,e.url=e.getUrl(e.src),n.abrupt("return",l);case 29:return n.abrupt("return","NULL");case 30:case"end":return n.stop()}},n,null,[[2,11],[17,23]])}));return function(e,t){return n.apply(this,arguments)}}(),this.url=this.getUrl(this.src),this.infiniteScroll&&this.infiniteScroll.destroy(),this.infiniteScroll=new x({$result:this.resultWrapper,$loading:this.loadingWrapper,loadingHtml:this.params.loadingHtml,loadFailHtml:this.params.loadFailHtml,loadOverHtml:this.params.loadOverHtml,bufferHeightPx:this.params.bufferHeightPx,pageResultNum:this.params.prn,limitShowPn:0,preLoadPn:2,firstResult:[],pushResult:this.pushResult})}},{key:"resetDOM",value:function(){if(this.resultWrapper)if(this.resultInitChildNodes&&this.resultInitChildNodes.length)for(var e=0,t=Array.from(this.resultWrapper.childNodes);e<t.length;e++){var n=t[e];this.resultInitChildNodes.indexOf(n)<0&&this.resultWrapper.removeChild(n)}else this.resultWrapper.innerHTML="";this.loadingWrapper&&(this.loadingWrapper.innerHTML=this.loadingInitHTML)}},{key:"disconnectedCallback",value:function(){this.infiniteScroll.destroy()}},{key:"getUrl",value:function(e){var t=e;return e.indexOf("?")>0?(t+="?"===e[e.length-1]?"":"&",t+=this.params.pnName+"="+this.params.pn):t+="?"+this.params.pnName+"="+this.params.pn,t}}],[{key:"observedAttributes",get:function(){return["data-src"]}}]),t}(S)}]);e.__esModule&&(e=e.default),e&&MIP.registerElement("mip-infinitescroll",e)}});